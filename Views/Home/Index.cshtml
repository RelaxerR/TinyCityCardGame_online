@model HomeViewModel

<div class="main-container text-center">
    <h1 class="game-title">Tiny City Online</h1>
    
    <div class="scroll-box">
        <!-- Вывод ошибок (если комната не найдена или имя занято) -->
        @if (TempData["Error"] != null)
        {
            <div class="alert-wood">⚠️ @TempData["Error"]</div>
        }

        <form asp-action="CreateLobby" method="post">
            <input asp-for="PlayerName" id="playerName" placeholder="Ваше имя, поселенец..." class="custom-input" required autocomplete="off" />
            <br />
            <button type="submit" id="btnCreate" class="btn-wood" disabled>Основать колонию</button>
        </form>

        <hr class="divider" />

        <form asp-action="JoinLobby" method="post">
            <!-- Скрытое поле для имени, чтобы передать его вместе с кодом -->
            <input type="hidden" name="PlayerName" class="name-mirror" />
            <input asp-for="RoomCode" placeholder="Код порта..." class="custom-input" autocomplete="off" />
            <button type="submit" id="btnJoin" class="btn-stone" disabled>Войти в гавань</button>
        </form>
    </div>
</div>

<script>
    const nameInput = document.getElementById('playerName');
    const btnCreate = document.getElementById('btnCreate');
    const btnJoin = document.getElementById('btnJoin');
    const nameMirrors = document.querySelectorAll('.name-mirror');

    // 1. При загрузке восстанавливаем имя
    document.addEventListener("DOMContentLoaded", () => {
        const savedName = localStorage.getItem('catan_playerName');
        if (savedName) {
            nameInput.value = savedName;
            updateButtons(savedName);
        }
    });

    function updateButtons(val) {
        const isDisabled = val.trim().length < 2;
        btnCreate.disabled = isDisabled;
        btnJoin.disabled = isDisabled;
        nameMirrors.forEach(m => m.value = val);
    }

    nameInput.addEventListener('input', function() {
        updateButtons(this.value);
    });

    // 2. При клике на любую кнопку — сохраняем имя
    const saveName = () => {
        localStorage.setItem('catan_playerName', nameInput.value.trim());
    };

    btnCreate.addEventListener('click', saveName);
    btnJoin.addEventListener('click', saveName);
</script>

<style>
    /* Стиль для ошибки в духе игры */
    .alert-wood { background: #ffebcd; color: #8b0000; border: 2px solid #8b4513; padding: 10px; margin-bottom: 15px; border-radius: 5px; font-weight: bold; }
    button:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
    
    body { background-color: #e4d5b7; font-family: 'Georgia', serif; }
    .game-title { color: #8b4513; font-size: 3rem; text-shadow: 2px 2px #fff; margin-top: 50px; }
    .scroll-box { 
        background: #fdf5e6; 
        border: 10px solid #8b4513; 
        border-radius: 15px; 
        padding: 40px; 
        width: 400px; 
        margin: 0 auto; 
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }
    .custom-input { 
        padding: 10px; border: 2px solid #a0522d; border-radius: 5px; width: 80%; margin-bottom: 20px;
    }
    .btn-wood { 
        background: #a0522d; color: white; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer;
    }
    .btn-wood:hover { background: #8b4513; }
</style>