<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
<script src="/js/game-connector.js"></script>

<script>
    let lastActivePlayer = "";
    let previousMarketCount = 0;

    document.addEventListener("DOMContentLoaded", () => {
        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –æ–±—â–∏–π –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä
        GameApp.start(() => {
            console.log("–ò–≥—Ä–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞. –ó–∞–ø—Ä–∞—à–∏–≤–∞—é —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç–æ–ª–∞...");
            GameApp.connection.invoke("InitGameView", GameApp.roomCode);
        });

        // 2. –°–ª—É—à–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–æ–ª–∞
        GameApp.connection.on("UpdateTable", (data) => {
            renderGame(data);
        });

        // 3. –°–ª—É—à–∞—Ç–µ–ª—å —Ñ–∏–Ω–∞–ª–∞
        GameApp.connection.on("GameOver", (winnerName) => {
            showTurnAlert("üëë –¢–†–ò–£–ú–§! " + winnerName.toUpperCase() + " –ù–ê–ë–†–ê–õ 100 –ú–û–ù–ï–¢!");
            setTimeout(() => { window.location.href = "/"; }, 5000);
        });

        // 4. –°–æ–æ–±—â–µ–Ω–∏—è –æ –∫—Ä–∞–∂–∞—Ö –∏ —Å–æ–±—ã—Ç–∏—è—Ö
        GameApp.connection.on("ShowMessage", (msg, type) => {
            addToLog(msg, type); // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–≤–∏—Ç–æ–∫
            showTurnAlert(msg);  // –ò –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ –Ω–∞ —Å–µ–∫—É–Ω–¥—É
        });

        GameApp.connection.on("GameOver", (winnerName) => {
            // 1. –°–æ–∑–¥–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –ø–æ–±–µ–¥—ã
            const overlay = document.createElement("div");
            overlay.className = "victory-overlay";
            overlay.innerHTML = `
        <div class="victory-box">
            <h1 class="victory-title">üëë –¢–†–ò–£–ú–§ üëë</h1>
            <div class="winner-name">${winnerName.toUpperCase()}</div>
            <p>–í–æ–∑–≤—ë–ª –≤–µ–ª–∏—á–∞–π—à—É—é —Å—Ç–æ–ª–∏—Ü—É –∏ –Ω–∞–∫–æ–ø–∏–ª –±–æ–≥–∞—Ç—Å—Ç–≤–∞!</p>
            <hr class="victory-hr">
            <div id="countdown-msg">–í–æ–∑–≤—Ä–∞—Ç –≤ –ø–æ—Ä—Ç —á–µ—Ä–µ–∑ <span id="timer-sec">5</span>...</div>
        </div>
        <div id="coin-rain"></div>
    `;
            document.body.appendChild(overlay);

            // 2. –ó–∞–ø—É—Å–∫–∞–µ–º "–ó–æ–ª–æ—Ç–æ–π –¥–æ–∂–¥—å" (–∞–Ω–∏–º–∞—Ü–∏—è –º–æ–Ω–µ—Ç)
            startCoinRain();

            // 3. –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç (5 —Å–µ–∫—É–Ω–¥)
            let seconds = 5;
            const timerElem = document.getElementById("timer-sec");
            const interval = setInterval(() => {
                seconds--;
                if (timerElem) timerElem.innerText = seconds;
                if (seconds <= 0) {
                    clearInterval(interval);
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏–ª–∏ –ª–æ–±–±–∏
                    window.location.href = "/";
                }
            }, 1000);
        });
    });

    function startCoinRain() {
        const container = document.getElementById("coin-rain");
        for (let i = 0; i < 50; i++) {
            const coin = document.createElement("div");
            coin.className = "falling-coin";
            coin.innerText = "üí∞";
            coin.style.left = Math.random() * 100 + "vw";
            coin.style.animationDelay = Math.random() * 2 + "s";
            coin.style.fontSize = (Math.random() * 20 + 20) + "px";
            container.appendChild(coin);
        }
    }
    
    function renderGame(data) {
        const myName = GameApp.userName;
        const currentPlayerName = data.currentPlayer;
        const isMyTurn = (myName === currentPlayerName);
        
        // –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∫ —Å—Ç—Ä–æ–∫–µ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        const activeColorStr = String(data.activeColor).toLowerCase();
        const myData = data.players.find(p => p.name === myName);

        // --- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –†–ê–£–ù–î–ï ---
        const roundElem = document.getElementById("roundNum");
        if (roundElem) roundElem.innerText = data.roundNumber || 1;

        // --- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –•–û–î–ï ---
        if (isMyTurn && lastActivePlayer !== myName) {
            showTurnAlert("üè∞ –í–ê–® –•–û–î, –ü–û–°–ï–õ–ï–ù–ï–¶!");
        }
        lastActivePlayer = currentPlayerName;

        // --- –°–ü–ò–°–û–ö –ò–ì–†–û–ö–û–í (–í–´) ---
        const playersDiv = document.getElementById("playersList");
        playersDiv.innerHTML = data.players.map(p => {
            const isTurn = p.name === currentPlayerName;
            return `
            <div class="player-pill ${isTurn ? 'active-glow' : ''}">
                ${p.name} ${p.name === myName ? '<strong>(–í—ã)</strong>' : ''}: 
                <strong>${p.coins}üí∞</strong>
            </div>`;
        }).join('');

        // --- –ò–ù–î–ò–ö–ê–¢–û–† –§–ê–ó–´ ---
        const colorBox = document.getElementById("currentPhaseColor");
        if (colorBox) colorBox.className = "color-indicator " + activeColorStr;

        // --- –†–´–ù–û–ö (–° –∞–Ω–∏–º–∞—Ü–∏–µ–π –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è) ---
        const marketDiv = document.getElementById("marketCards");
        const isReplenishing = data.market.length > previousMarketCount;

        marketDiv.innerHTML = data.market.map((card, index) => {
            const canAfford = isMyTurn && !myData.hasBoughtThisTurn && myData.coins >= card.cost;
            const animClass = (isReplenishing && index >= previousMarketCount) ? 'market-card-anim' : '';

            // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏
            const cardImg = card.icon
                ? `<img src="${card.icon}" class="card-illustration" alt="${card.name}">`
                : `<div class="no-icon">üè∞</div>`; // –ó–∞–≥–ª—É—à–∫–∞, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ—Ç

            return `
                <div class="card-item ${animClass} ${canAfford ? 'can-afford' : 'disabled'}" 
                     onclick="buyCard(${card.id}, ${canAfford})">
                    <div class="card-header ${card.color.toLowerCase()}">${card.name}</div>
                    <div class="card-body">
                        <div class="img-container">
                            ${cardImg}
                        </div>
                        <div class="card-price">–¶–µ–Ω–∞: ${card.cost}üí∞</div>
                    </div>
                    <div class="card-footer">${card.description || '–†–µ—Å—É—Ä—Å'}</div>
                </div>`;
        }).join('');
        
        previousMarketCount = data.market.length;

        // --- –ò–ù–í–ï–ù–¢–ê–†–¨ (Flip-—ç—Ñ—Ñ–µ–∫—Ç –∏ –ê–∫—Ç–∏–≤–∞—Ü–∏—è) ---
        const inventoryDiv = document.getElementById("myInventory");

        if (myData && inventoryDiv) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã
            const myCoinsElem = document.getElementById("myCoins");
            if (myCoinsElem) myCoinsElem.innerText = myData.coins;

            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            const serverActiveColor = String(data.activeColor || "").toLowerCase();

            if (myData.inventory && myData.inventory.length > 0) {
                inventoryDiv.innerHTML = myData.inventory.map(c => {
                    const cardColor = String(c.color || "").toLowerCase();
                    const isRightPhase = (cardColor === serverActiveColor);

                    // –ö–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞: –º–æ–π —Ö–æ–¥ + —Ñ–∞–∑–∞ —Å–æ–≤–ø–∞–ª–∞ + –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
                    const canActivate = isRightPhase && isMyTurn && !c.isUsed;
                    const usedClass = c.isUsed ? "card-used" : "";

                    // –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞
                    const cardImgHtml = c.icon
                        ? `<img src="${c.icon}" class="card-illustration-mini" alt="${c.name}">`
                        : `<div class="no-icon-mini">üè∞</div>`;

                    return `
            <div class="card-mini-container ${!isRightPhase ? 'wrong-phase' : ''} ${canActivate ? 'clickable-card' : ''}" 
                 onclick="useCard(${c.id}, ${canActivate}, event)">
                <div class="card-mini-inner">
                    <!-- –õ–ò–¶–û –ö–ê–†–¢–´ -->
                    <div class="card-front ${cardColor} ${canActivate ? 'active-card-glow' : ''} ${usedClass}">
                         <div class="img-container-mini">
                            ${cardImgHtml}
                         </div>
                         <div class="card-mini-name">${c.name || '–ö–∞—Ä—Ç–∞'}</div>
                    </div>
                    <!-- –†–£–ë–ê–®–ö–ê -->
                    <div class="card-back">
                        <strong style="font-size: 0.8rem;">${c.name}</strong>
                        <p style="font-size: 10px; margin: 2px 0;">${c.description || '–≠—Ñ—Ñ–µ–∫—Ç –ø–æ—Å–µ–ª–µ–Ω–∏—è'}</p>
                        <div style="border-top: 1px solid #ffd700; width: 100%; margin-top: auto; padding-top: 3px;">
                            <span style="color: #ffd700; font-weight: bold; font-size: 0.7rem;">${c.effect || ''}</span>
                        </div>
                    </div>
                </div>
            </div>`;
                }).join('');
            } else {
                inventoryDiv.innerHTML = "<p style='opacity:0.5; padding: 20px;'>–í–∞—à–∏ –≤–ª–∞–¥–µ–Ω–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç—ã...</p>";
            }
        }

        // --- –ö–ù–û–ü–ö–ê –ó–ê–í–ï–†–®–ï–ù–ò–Ø –•–û–î–ê ---
        const endBtn = document.getElementById("endTurnBtn");
        if(endBtn) endBtn.disabled = !isMyTurn;
    }

    // --- –§–£–ù–ö–¶–ò–ò –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø ---

    function buyCard(cardId, canAfford) {
        if (!canAfford) return;
        GameApp.connection.invoke("PlayerClickCard", GameApp.roomCode, cardId)
            .catch(err => console.error("–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:", err));
    }

    function useCard(cardId, canActivate, event) {
        if (!canActivate) return;

        // –ê–Ω–∏–º–∞—Ü–∏—è –≤—ã–ª–µ—Ç–∞—é—â–µ–π –º–æ–Ω–µ—Ç–∫–∏
        const coin = document.createElement("div");
        coin.className = "coin-anim";
        coin.innerText = "+üí∞";
        coin.style.left = event.pageX + "px";
        coin.style.top = event.pageY + "px";
        document.body.appendChild(coin);
        setTimeout(() => coin.remove(), 1000);

        GameApp.connection.invoke("ActivateCard", GameApp.roomCode, cardId)
            .catch(err => console.error("–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:", err));
    }

    function finishTurn() {
        GameApp.connection.invoke("EndTurn", GameApp.roomCode)
            .catch(err => console.error("–û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ö–æ–¥–∞:", err));
    }

    function showTurnAlert(text) {
        const alertBox = document.getElementById("turn-alert");
        if(!alertBox) return;
        alertBox.innerText = text;
        alertBox.style.display = "block";
        setTimeout(() => { alertBox.style.display = "none"; }, 3000);
    }

    function addToLog(message, type = "") {
        const logDiv = document.getElementById("gameLog");
        const item = document.createElement("div");
        item.className = `log-item ${type}`;

        const now = new Date();
        const timeStr = `[${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}] `;

        item.innerHTML = `<span>${timeStr}${message}</span>`;
        logDiv.appendChild(item);

        // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑ (—Ö–æ—Ç—è flex-direction: column-reverse —É–∂–µ –ø–æ–º–æ–≥–∞–µ—Ç)
        logDiv.scrollTop = logDiv.scrollHeight;
    }
</script>

<div id="turn-alert"></div>
<div class="log-container">
    <div class="log-header">üìú –õ–ï–¢–û–ü–ò–°–¨ –°–û–ë–´–¢–ò–ô</div>
    <div id="gameLog" class="log-content">
        <div class="log-item">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–∞–≤–∞–Ω—å!</div>
    </div>
</div>
<div class="game-board">
    <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨: –ò–≥—Ä–æ–∫–∏ –∏ –¢–µ–∫—É—â–∏–π —Ü–≤–µ—Ç -->
    <div class="top-bar">
        <div class="active-event">
            <span>–ê–∫—Ç–∏–≤–Ω–∞—è —Ñ–∞–∑–∞:</span>
            <div id="currentPhaseColor" class="color-indicator blue"></div>
        </div>
        
        <div class="turn-info">
            <span class="round-badge">–†–ê–£–ù–î: <strong id="roundNum">1</strong></span>
        </div>
        
        <div class="players-status" id="playersList">
            <!-- –°—é–¥–∞ SignalR –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –∏–≥—Ä–æ–∫–æ–≤ –∏ –∏—Ö –º–æ–Ω–µ—Ç—ã -->
            <div class="player-pill active">–ò–≥—Ä–æ–∫ 1: 15üí∞</div>
            <div class="player-pill">–ò–≥—Ä–æ–∫ 2: 10üí∞</div>
        </div>
    </div>

    <!-- –†–´–ù–û–ö: –ö–æ–ª–æ–¥–∞ + 5 –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∫–∞—Ä—Ç -->
    <div class="market-zone">
        <div class="deck-stack">
            <div class="card-back-v">
                <div class="deck-title">–ö–û–õ–û–î–ê</div>
                <div class="deck-count">???</div>
            </div>
        </div>
        <div class="open-market" id="marketCards">
            <!-- –°—é–¥–∞ –≤–ª–µ—Ç–∞—é—Ç –∫–∞—Ä—Ç—ã -->
        </div>
    </div>

    <!-- –†–£–ö–ê –ò–ì–†–û–ö–ê -->
    <div class="player-hand-section">
        <h3>–í–∞—à–∏ –≤–ª–∞–¥–µ–Ω–∏—è</h3>
        <div class="my-cards" id="myInventory">
            <!-- –ö–∞—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∫—É–ø–ª–µ–Ω—ã -->
        </div>
        <div class="player-stats">
            <span class="coin-count">–í–∞—à–µ –∑–æ–ª–æ—Ç–æ: <strong id="myCoins">3</strong> üí∞</span>
            <button id="endTurnBtn" class="btn-stone" onclick="finishTurn()">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ö–æ–¥</button>
        </div>
    </div>
</div>

<style>
    .victory-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 10000;
        display: flex; align-items: center; justify-content: center;
        color: #ffd700; font-family: 'Georgia', serif;
    }
    .victory-box {
        background: #fdf5e6; border: 8px double #8b4513; padding: 40px;
        text-align: center; border-radius: 15px; box-shadow: 0 0 100px #ffd700;
        color: #4a2c2a; position: relative; z-index: 10001;
    }
    .victory-title { font-size: 4rem; text-shadow: 2px 2px #fff; color: #8b4513; }
    .winner-name { font-size: 2.5rem; font-weight: bold; margin: 20px 0; color: #b8860b; }
    .victory-hr { border-color: #d2b48c; margin: 20px 0; }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–∞—é—â–∏—Ö –º–æ–Ω–µ—Ç */
    .falling-coin {
        position: absolute; top: -50px;
        animation: fall linear 3s infinite;
        pointer-events: none;
    }
    @@keyframes fall {
        to { transform: translateY(110vh) rotate(360deg); }
    }

    .victory-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 9999;
        display: flex; align-items: center; justify-content: center;
        animation: fadeIn 1s;
    }
    .victory-box {
        background: #fdf5e6; border: 10px solid #ffd700; padding: 50px;
        text-align: center; border-radius: 20px; box-shadow: 0 0 50px #ffd700;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è: —Ç–µ–ø–µ—Ä—å –∫–∞—Ä—Ç—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É */
    #myInventory {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding: 15px;
        justify-content: flex-start;
        max-height: 400px; /* –û–≥—Ä–∞–Ω–∏—á–∏–º –≤—ã—Å–æ—Ç—É, –µ—Å–ª–∏ –∫–∞—Ä—Ç —Å—Ç–∞–Ω–µ—Ç –û–ß–ï–ù–¨ –º–Ω–æ–≥–æ */
        overflow-y: auto;
    }

    /* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä—É–±–∞—à–∫—É –∫–∞—Ä—Ç—ã */
    .card-back {
        background: #5d2e0a url('https://www.transparenttextures.com');
        color: #ffd700;
        padding: 10px;
        font-size: 10px;
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –Ω–µ —Å–ª–∏–ø–∞–ª—Å—è */
        align-items: center;
        text-align: center;
        border: 2px solid #ffd700;
        transform: rotateY(180deg);
        box-sizing: border-box; /* –ß—Ç–æ–±—ã padding –Ω–µ —Ä–∞–∑–¥—É–≤–∞–ª –∫–∞—Ä—Ç—É */
    }

    /* –¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ä—É–±–∞—à–∫–∏ */
    .card-back p {
        margin: 5px 0;
        line-height: 1.2;
        overflow-y: auto; /* –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –°–õ–ò–®–ö–û–ú –¥–ª–∏–Ω–Ω—ã–π, –ø–æ—è–≤–∏—Ç—Å—è –º–∏–∫—Ä–æ-—Å–∫—Ä–æ–ª–ª */
        width: 100%;
        word-wrap: break-word;
    }

    /* –£–≤–µ–ª–∏—á–∏–º –Ω–µ–º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
    .card-mini-container {
        perspective: 1000px;
        width: 110px;  /* –ß—É—Ç—å —à–∏—Ä–µ */
        height: 150px; /* –ß—É—Ç—å –≤—ã—à–µ */
        margin: 5px;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ –º–∞–ª–µ–Ω—å–∫–æ–π –∫–∞—Ä—Ç–µ */
    .img-container-mini {
        width: 90%;
        height: 60px; /* –ß—É—Ç—å –º–µ–Ω—å—à–µ, —á–µ–º –Ω–∞ —Ä—ã–Ω–∫–µ */
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        background: rgba(255,255,255,0.2);
        border-radius: 4px;
        margin-top: 5px;
    }

    .card-illustration-mini {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    .card-mini-name {
        font-size: 0.7rem;
        font-weight: bold;
        margin-top: 2px;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 90%;
    }

    /* –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è */
    .no-icon-mini {
        font-size: 1.5rem;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç—ã */
    .img-container {
        width: 100%;
        height: 80px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ */
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        margin-bottom: 5px;
        background: rgba(0,0,0,0.05); /* –õ–µ–≥–∫–∞—è —Ç–µ–Ω—å –ø–æ–¥ –∫–∞—Ä—Ç–∏–Ω–∫–æ–π */
        border-radius: 4px;
    }

    /* –°–∞–º–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ */
    .card-illustration {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain; /* –ö–∞—Ä—Ç–∏–Ω–∫–∞ –≤–ø–∏—à–µ—Ç—Å—è –±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π */
        transition: transform 0.3s;
    }

    .card-item:hover .card-illustration {
        transform: scale(1.1); /* –õ–µ–≥–∫–∏–π –∑—É–º –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    }

    .card-price {
        font-weight: bold;
        font-size: 0.9rem;
        color: #4a2c2a;
    }

    .no-icon {
        font-size: 2rem;
        opacity: 0.5;
    }

    .card-illustration {
        width: 80%;
        height: 100px;
        object-fit: contain; /* –ß—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–ª–∞—Å—å */
        margin: 5px auto;
        display: block;
        border-radius: 5px;
        background: rgba(0,0,0,0.05); /* –õ–µ–≥–∫–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ */
    }

    .log-container {
        position: fixed; right: 20px; top: 150px;
        width: 250px; background: rgba(253, 245, 230, 0.9);
        border: 3px solid #8b4513; border-radius: 10px;
        box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
    }
    .log-header {
        background: #8b4513; color: #ffd700; padding: 5px;
        text-align: center; font-weight: bold; font-size: 0.8rem;
    }
    .log-content {
        max-height: 200px; overflow-y: auto; padding: 10px;
        display: flex; flex-direction: column-reverse; /* –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–≤–µ—Ä—Ö—É */
    }
    .log-item {
        font-size: 0.85rem; border-bottom: 1px dashed #d2b48c; padding: 3px 0;
        animation: fadeIn 0.5s ease;
    }
    .log-item.important { color: #8b0000; font-weight: bold; }
    .log-item.gold { color: #b8860b; }
    
    /* –ö–∞—Ä—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º —Ü–≤–µ—Ç–æ–º —Ñ–∞–∑—ã */
    .card-mini-container.wrong-phase {
        filter: sepia(0.8) brightness(0.8);
        opacity: 0.6;
    }
    /* –ü–æ–¥—Å–∫–∞–∑–∫–∞, —á—Ç–æ –º–æ–Ω–µ—Ç–∞ –≤—ã–¥–∞–Ω–∞ */
    .income-notif {
        color: #2ecc71;
        font-weight: bold;
        animation: fadeUp 2s forwards;
    }

    @@keyframes coin-fly {
        0% { transform: translateY(0); opacity: 1; }
        100% { transform: translateY(-50px); opacity: 0; }
    }
    .coin-anim {
        position: absolute; color: #ffd700; font-weight: bold;
        font-size: 1.5rem; pointer-events: none;
        animation: coin-fly 1s forwards; z-index: 2000;
    }

    .card-header.gold, .card-front.gold { background: #f1c40f; color: #000; }
    .card-header.blue, .card-front.blue { background: #3498db; color: #fff; }
    .card-header.red, .card-front.red { background: #e74c3c; color: #fff; }
    .card-header.purple, .card-front.purple { background: #9b59b6; color: #fff; }

    .card-mini-container {
        perspective: 1000px;
        width: 100px; height: 140px;
        margin: 10px;
        cursor: default;
        position: relative; /* –ß—Ç–æ–±—ã –∫–ª–∏–∫ –ª–æ–≤–∏–ª—Å—è —Ç–æ—á–Ω–æ —Ç—É—Ç */
    }

    .card-mini-container.clickable-card {
        cursor: pointer !important;
    }

    .card-mini-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s;
        transform-style: preserve-3d;
        pointer-events: none; /* –û—Ç–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏, —á—Ç–æ–±—ã –ª–æ–≤–∏–ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    }

    .card-mini-container:hover .card-mini-inner {
        transform: rotateY(180deg);
    }

    .card-front, .card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    /* –í–∞–∂–Ω–æ: —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ª–æ–≤–∏–ª –∫–ª–∏–∫, –∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–µ –º–µ—à–∞–ª–∏ */
    .card-mini-container * {
        pointer-events: none;
    }
    .card-mini-container {
        pointer-events: all;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç –Ω–∞ —Ä—ã–Ω–∫–µ */
    .market-card-anim {
        animation: slideInFromDeck 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @@keyframes slideInFromDeck {
        0% { transform: translate(-200px, -50px) rotate(-20deg); opacity: 0; }
        100% { transform: translate(0, 0) rotate(0); opacity: 1; }
    }

    .round-badge {
        background: #8b4513; color: #ffd700; padding: 5px 15px;
        border-radius: 20px; border: 2px solid #ffd700;
    }

    .card-back-v {
        width: 120px; height: 180px;
        background: #5d2e0a;
        border: 4px solid #8b4513;
        border-radius: 10px;
        display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        color: #ffd700; font-weight: bold;
        box-shadow: 5px 5px 0 #3d1f07; /* –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—á–∫–∏ */
    }
    
    .active-card-glow {
        cursor: pointer;
        animation: pulse 1.5s infinite;
        border: 2px solid #ffd700 !important;
        transform: scale(1.1);
    }

    @@keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
        100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
    }

    .btn-stone {
        background: #708090;
        color: white;
        padding: 10px 20px;
        border: 3px solid #2f4f4f;
        cursor: pointer;
        font-weight: bold;
    }
    .btn-stone:hover { background: #4f666a; }

    .card-used {
        opacity: 0.4;
        filter: grayscale(1);
        transform: scale(0.9);
        pointer-events: none; /* –ß—Ç–æ–±—ã –Ω–µ–ª—å–∑—è –±—ã–ª–æ –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
        transition: all 0.3s ease;
    }

    .game-board { background: #d2b48c; height: 100vh; padding: 20px; display: flex; flex-direction: column; gap: 30px; }
    
    /* –°—Ç–∏–ª–∏ –ø–∞–Ω–µ–ª–µ–π */
    .top-bar { display: flex; justify-content: space-between; background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px; }
    .color-indicator { width: 40px; height: 40px; border-radius: 50%; border: 3px solid #fff; display: inline-block; }
    .blue { background: #3498db; } .green { background: #2ecc71; } 
    .red { background: #e74c3c; } .purple { background: #9b59b6; }

    /* –†—ã–Ω–æ–∫ */
    .market-zone { display: flex; gap: 20px; justify-content: center; align-items: center; }
    .open-market { display: flex; gap: 15px; background: rgba(0,0,0,0.1); padding: 20px; border-radius: 15px; }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∞ */
    .card-item { 
        width: 120px; height: 180px; background: #fffdf0; border: 4px solid #8b4513; 
        border-radius: 10px; position: relative; cursor: pointer; transition: transform 0.2s;
    }
    .card-item:hover { transform: translateY(-10px); }
    .card-header { height: 30px; color: white; text-align: center; font-weight: bold; }
    
    .card-back { 
        width: 120px; height: 180px; background: #8b4513; color: white; 
        display: flex; align-items: center; justify-content: center; border-radius: 10px; 
    }

    .player-hand-section { margin-top: auto; background: #f5f5dc; padding: 20px; border-radius: 20px 20px 0 0; border-top: 5px solid #a0522d; }
    .my-cards { display: flex; gap: 10px; overflow-x: auto; }

    .player-pill.active-glow {
        border: 3px solid #ffd700;
        box-shadow: 0 0 15px #ffd700;
        transform: scale(1.1);
        background: #8b4513;
        color: white;
    }
    .card-item.clickable:hover { border-color: #ffd700; cursor: pointer; }
    .card-item.disabled { opacity: 0.7; cursor: not-allowed; }

    .active-glow {
        background: #8b4513 !important;
        color: #ffd700 !important;
        box-shadow: 0 0 20px #ffd700;
        border: 2px solid #ffd700;
    }
    .card-mini {
        width: 40px; height: 60px; border-radius: 5px;
        display: inline-flex; align-items: center; justify-content: center;
        margin-right: 5px; border: 1px solid #000; font-size: 1.5rem;
    }
    .card-item.disabled { filter: grayscale(0.5); opacity: 0.8; }
    .card-footer { background: rgba(0,0,0,0.1); font-weight: bold; border-radius: 0 0 10px 10px; }

    /* 1. –§–æ–Ω –∏–≥—Ä–æ–≤–æ–≥–æ —Å—Ç–æ–ª–∞ */
    .game-board {
        background: url('https://img.freepik.com') center/cover no-repeat;
        box-shadow: inset 0 0 200px rgba(0,0,0,0.5);
    }

    /* 2. –§–æ–Ω –ª–∏—Ü–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –∫–∞—Ä—Ç (–ø–µ—Ä–≥–∞–º–µ–Ω—Ç) */
    .card-item, .card-front {
        background: url('https://www.transparenttextures.com'), #fdf5e6;
        border: 3px solid #8b4513;
        border-radius: 8px;
    }

    /* 3. –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –¥–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è */
    .card-mini-container {
        perspective: 1000px;
        width: 60px; height: 90px;
    }

    .card-mini-inner {
        position: relative; width: 100%; height: 100%;
        transition: transform 0.6s; transform-style: preserve-3d;
    }

    .card-mini-container:hover .card-mini-inner {
        transform: rotateY(180deg);
    }

    .card-front, .card-back {
        position: absolute; width: 100%; height: 100%;
        backface-visibility: hidden; border-radius: 5px;
    }

    /* –†—É–±–∞—à–∫–∞ –∫–∞—Ä—Ç—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ */
    .card-back {
        background: #5d2e0a url('https://www.transparenttextures.com');
        color: #ffd700; display: flex; align-items: center; justify-content: center;
        border: 2px solid #ffd700; transform: rotateY(180deg);
    }

    /* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ö–æ–¥–µ */
    #turn-alert {
        position: fixed; top: 20%; left: 50%; transform: translate(-50%, -50%);
        background: rgba(139, 69, 19, 0.9); color: white; padding: 20px 40px;
        border: 4px solid #ffd700; border-radius: 15px; z-index: 1000;
        font-size: 2rem; display: none; pointer-events: none;
    }

    /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å */
    .card-mini-container {
        perspective: 1000px;
        width: 100px; height: 140px; /* –ë—ã–ª–æ 60x90 */
        margin: 5px;
    }

    .card-back {
        background: #5d2e0a;
        color: #ffd700;
        padding: 8px;
        font-size: 11px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
        border: 2px solid #ffd700;
        transform: rotateY(180deg);
    }

    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫–∞—Ä—Ç */
    .card-item.can-afford {
        box-shadow: 0 0 15px #2ecc71;
        border-color: #2ecc71 !important;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã */
    @@keyframes card-fly-in {
        0% { transform: scale(0) translateX(-200px); opacity: 0; }
        100% { transform: scale(1) translateX(0); opacity: 1; }
    }

    .new-card-anim {
        animation: card-fly-in 0.5s ease-out;
    }

    /* –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ö–æ–¥" –∞–∫—Ç–∏–≤–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ */
    .btn-stone:disabled {
        filter: grayscale(1);
        opacity: 0.5;
        cursor: not-allowed;
    }


</style>